<div class="page-header">
  <%= link_to new_pedido_path, class: 'btn btn-primary' do %>
    <span class="glyphicon glyphicon-plus"></span>
    Nova entrada
  <% end %>
  <h1>Listando entradas</h1>
</div>

<hr>

<form action="/usuarios" method="get" class="busca">
  <div style="clear:both">
    <label>Dados do usuário:</label>
    <input type="text" class="form-control" name="nome" value="<%= params[:nome] %>" />
    <input type="submit" value="Buscar" class="btn btn-primary">
  </div>
</form>
<hr>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
  google.charts.load('current', {'packages':['corechart']});
  google.charts.setOnLoadCallback(drawChart);

  function drawChart() {

    var data = google.visualization.arrayToDataTable([
      ['Status', 'Quantidade'],
      ['Pago', <%= Pedido.valor_total(Pedido::PAGO) %>],
      ['Aguardando', <%= Pedido.valor_total(Pedido::AGUARDANDO) %>],
      ['Cacelado', <%= Pedido.valor_total(Pedido::CANCELADO) %>]
    ]);

    var options = {
      title: 'Histórico de pagamentos'
    };

    var chart = new google.visualization.PieChart(document.getElementById('pedidosChart'));

    chart.draw(data, options);
  }
</script>

<div class="row">
  <div class="col-sm-6">
    <div id="pedidosChart" style="width: 100%; height: 300px;"></div>
  </div>
  <div class="col-sm-6">
    <h3>Valor pago: <%= number_to_currency(Pedido.valor_total(Pedido::PAGO), :unit => "R$") %></h3>
    <h3>Valor aguardando: <%= number_to_currency(Pedido.valor_total(Pedido::AGUARDANDO), :unit => "R$") %></h3>
    <h3>Valor cancelado: <%= number_to_currency(Pedido.valor_total(Pedido::CANCELADO), :unit => "R$") %></h3>
  </div>
</div>

<hr>

<div class="table-responsive">
  <table class="table table-striped table-bordered table-hover">
    <thead>
      <tr>
        <th>Placa</th>
        <th>Data emissao fatura</th>
        <th>Descricao</th>
        <th>Numero fatura</th>
        <th>Data inicio</th>
        <th>Data fim</th>
        <th>Vencimento</th>
        <th>Valor</th>
        <th>Status</th>
        <th>Detalhes</th>
        <th></th>
        <th></th>
        <th></th>
      </tr>
    </thead>

    <tbody>
      <%= content_tag_for(:tr, @pedidos) do |pedido| %>
        <td><%= pedido.placa %></td>
        <td><%= pedido.data_emissao_fatura.strftime("%d/%m/%Y") %></td>
        <td><%= pedido.descricao %></td>
        <td><%= pedido.numero_fatura %></td>
        <td><%= pedido.data_inicio.strftime("%d/%m/%Y") %></td>
        <td><%= pedido.data_fim.strftime("%d/%m/%Y") %></td>
        <td><%= pedido.vencimento.strftime("%d/%m/%Y") %></td>
        <td><%= pedido.valor %></td>
        <td style="text-align: center;">
          <% Pedido.todos_status.each do |id,nome| %>
            <% if pedido.status.to_s == id %>
              <a class="btn btn-primary" style="margin-bottom: 10px; width: 100px"><%= nome %></a>
            <% else %>
              <a href="?statusmudar=<%= pedido.id %>&status=<%= id %>" class="btn btn-default" data-confirm="Confirma?" style="margin-bottom: 10px; width: 100px"><%= nome %></a>
            <% end %>
          <% end %>
        </td>
        <td><%= link_to 'Detalhes', pedido_pedido_produtos_path(pedido) %></td>
        <td><%= link_to 'Mostrar', pedido %></td>
        <td><%= link_to 'Editar', edit_pedido_path(pedido) %></td>
        <td><%= link_to 'Apagar', pedido, method: :delete, data: { confirm: 'Confirma?' } %></td>
      <% end %>
    </tbody>
  </table>
  <div class="apple_pagination">
    <%= will_paginate @pedidos, :container => false %>
  </div>
</div>
